{% extends 'base.html.twig' %}

{% block title %}{{ 'account.list.title'|trans }}{% endblock %}

{% block body %}
    {{ include('common/page_header.html.twig', {'route_return': 'category_index', 'title': 'category.add.title'|trans}) }}
    {{ form_start(form) }}
    <div class="row">
        <div class="col-8">{{ form_row(form.label) }}</div>
        <div class="col-4">{{ form_row(form.badgeColor) }}</div>
    </div>
    <div class="row">
        <div class="col">
            {{ form_row(form.tags) }}
            <div class="chips" id="tag_filter" data-autocomplete="{{ tags|join(',') }}"></div>
        </div>
    </div>
<div class="row">
    <div class="col">
        <button class="form-control btn btn-outline-success">{{ button_label|default('Save') }}</button>
    </div>
</div>
    {{ form_end(form) }}
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script type="text/javascript">
        document.getElementById('category_tags').style = "display:none";
        let chips = new Array();
        let dataChips = document.getElementById('category_tags').value.split(',');
        if (dataChips != ""){
            for (let chip of dataChips){
                chips.push({
                    tag: chip
                });
            }
        }

        let dataAutocomplete = [];
        for (let tag of document.getElementById('tag_filter').getAttribute('data-autocomplete').split(',')){
            dataAutocomplete[tag] = null;
        }

        var elems = document.querySelectorAll('.chips');//document.querySelectorAll('.chips');
        let chipInstances = M.Chips.init(elems, {
           data: chips,
            autocompleteOptions: {
                data: dataAutocomplete,
                limit: Infinity,
                minLength: 1
            },
           onChipAdd:function(){
               if (this.chipsData != null){
                   var fieldTag = document.getElementById('category_tags');

                   fieldTag.value = "";
                   for(let chip of this.chipsData){
                       fieldTag.value += (fieldTag.value != ""?",":"");
                       fieldTag.value += chip.tag;
                   }
               }
            },
            onChipSelect: function(elt, chip){
               console.log(chip);
                chip.contentEditable = true;
            }
        });

    </script>
{% endblock %}
